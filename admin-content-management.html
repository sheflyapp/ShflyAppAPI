<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shfly - Content Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .editor-container {
            min-height: 300px;
        }
        .content-preview {
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body class="bg-gray-100" x-data="contentManager()">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <h1 class="text-xl font-bold text-gray-800">Shfly Content Management</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button @click="logout()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                        <i class="fas fa-sign-out-alt mr-2"></i>Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto py-6 px-4">
        <!-- Header -->
        <div class="mb-6">
            <h2 class="text-2xl font-bold text-gray-900">Static Content Management</h2>
            <p class="text-gray-600">Manage privacy policy, terms, help content, and more</p>
        </div>

        <!-- Content Types Tabs -->
        <div class="mb-6">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8">
                    <button 
                        v-for="contentType in contentTypes" 
                        :key="contentType.value"
                        @click="selectedType = contentType.value; loadContent()"
                        :class="[
                            'py-2 px-1 border-b-2 font-medium text-sm',
                            selectedType === contentType.value 
                                ? 'border-blue-500 text-blue-600' 
                                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                        ]"
                    >
                        <i :class="contentType.icon + ' mr-2'"></i>
                        {{ contentType.label }}
                    </button>
                </nav>
            </div>
        </div>

        <!-- Content Editor -->
        <div class="bg-white rounded-lg shadow">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">
                    {{ getContentTypeLabel() }} Content
                </h3>
            </div>

            <div class="p-6">
                <!-- Language Tabs -->
                <div class="mb-4">
                    <div class="flex space-x-4">
                        <button 
                            @click="currentLanguage = 'en'"
                            :class="[
                                'px-4 py-2 rounded-md text-sm font-medium',
                                currentLanguage === 'en' 
                                    ? 'bg-blue-100 text-blue-700' 
                                    : 'text-gray-500 hover:text-gray-700'
                            ]"
                        >
                            <i class="fas fa-flag-usa mr-2"></i>English
                        </button>
                        <button 
                            @click="currentLanguage = 'ar'"
                            :class="[
                                'px-4 py-2 rounded-md text-sm font-medium',
                                currentLanguage === 'ar' 
                                    ? 'bg-blue-100 text-blue-700' 
                                    : 'text-gray-500 hover:text-gray-700'
                            ]"
                        >
                            <i class="fas fa-flag mr-2"></i>العربية
                        </button>
                    </div>
                </div>

                <!-- Content Form -->
                <form @submit.prevent="saveContent()">
                    <div class="space-y-6">
                        <!-- Title -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Title
                            </label>
                            <input 
                                type="text" 
                                v-model="contentForm.title"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="Enter content title"
                                required
                            >
                        </div>

                        <!-- Content -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Content ({{ currentLanguage === 'en' ? 'English' : 'Arabic' }})
                            </label>
                            <textarea 
                                v-model="currentLanguage === 'en' ? contentForm.content : contentForm.contentAr"
                                rows="10"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 editor-container"
                                :placeholder="currentLanguage === 'en' ? 'Enter content in English...' : 'أدخل المحتوى باللغة العربية...'"
                                required
                            ></textarea>
                        </div>

                        <!-- SEO Fields -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    SEO Title
                                </label>
                                <input 
                                    type="text" 
                                    v-model="contentForm.seoTitle"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    placeholder="SEO title for search engines"
                                >
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Version
                                </label>
                                <input 
                                    type="text" 
                                    v-model="contentForm.version"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    placeholder="1.0.0"
                                >
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                SEO Description
                            </label>
                            <textarea 
                                v-model="contentForm.seoDescription"
                                rows="3"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="SEO description for search engines"
                            ></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                SEO Keywords (comma-separated)
                            </label>
                            <input 
                                type="text" 
                                v-model="contentForm.seoKeywordsString"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="keyword1, keyword2, keyword3"
                            >
                        </div>

                        <!-- Status -->
                        <div class="flex items-center">
                            <input 
                                type="checkbox" 
                                v-model="contentForm.isActive"
                                class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                            >
                            <label class="ml-2 block text-sm text-gray-700">
                                Active (visible to users)
                            </label>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex justify-end space-x-4">
                            <button 
                                type="button" 
                                @click="previewContent()"
                                class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"
                            >
                                <i class="fas fa-eye mr-2"></i>Preview
                            </button>
                            <button 
                                type="submit" 
                                :disabled="loading"
                                class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50"
                            >
                                <i class="fas fa-save mr-2"></i>
                                {{ loading ? 'Saving...' : 'Save Content' }}
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Content List -->
        <div class="mt-8 bg-white rounded-lg shadow">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">All Content</h3>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Title</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Version</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Updated</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <tr v-for="content in allContent" :key="content._id">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                {{ getContentTypeLabel(content.type) }}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                {{ content.title }}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                {{ content.version }}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span :class="[
                                    'inline-flex px-2 py-1 text-xs font-semibold rounded-full',
                                    content.isActive ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                ]">
                                    {{ content.isActive ? 'Active' : 'Inactive' }}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                {{ formatDate(content.updatedAt) }}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                <button 
                                    @click="editContent(content)"
                                    class="text-blue-600 hover:text-blue-900 mr-3"
                                >
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button 
                                    @click="deleteContent(content)"
                                    class="text-red-600 hover:text-red-900"
                                >
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div x-show="showPreview" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50" style="display: none;">
        <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-gray-900">Content Preview</h3>
                    <button @click="showPreview = false" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="content-preview border rounded p-4 bg-gray-50">
                    <h2 class="text-xl font-bold mb-4">{{ contentForm.title }}</h2>
                    <div v-html="formatContent(currentLanguage === 'en' ? contentForm.content : contentForm.contentAr)"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success/Error Messages -->
    <div x-show="message" class="fixed top-4 right-4 z-50" style="display: none;">
        <div :class="[
            'px-6 py-4 rounded-md shadow-lg',
            messageType === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
        ]">
            <div class="flex items-center">
                <i :class="messageType === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle'" class="mr-2"></i>
                <span x-text="message"></span>
            </div>
        </div>
    </div>

    <script>
        function contentManager() {
            return {
                // Data
                selectedType: 'privacy-policy',
                currentLanguage: 'en',
                loading: false,
                showPreview: false,
                message: '',
                messageType: 'success',
                allContent: [],
                
                contentTypes: [
                    { value: 'privacy-policy', label: 'Privacy Policy', icon: 'fas fa-shield-alt' },
                    { value: 'terms-conditions', label: 'Terms & Conditions', icon: 'fas fa-file-contract' },
                    { value: 'help', label: 'Help', icon: 'fas fa-question-circle' },
                    { value: 'onboarding', label: 'Onboarding', icon: 'fas fa-rocket' },
                    { value: 'about', label: 'About', icon: 'fas fa-info-circle' },
                    { value: 'contact', label: 'Contact', icon: 'fas fa-envelope' },
                    { value: 'faq', label: 'FAQ', icon: 'fas fa-question' }
                ],

                contentForm: {
                    title: '',
                    content: '',
                    contentAr: '',
                    version: '1.0.0',
                    seoTitle: '',
                    seoDescription: '',
                    seoKeywords: [],
                    seoKeywordsString: '',
                    isActive: true
                },

                // Methods
                async init() {
                    await this.loadAllContent();
                    await this.loadContent();
                },

                async loadContent() {
                    try {
                        const response = await fetch(`/api/content/${this.selectedType}?lang=${this.currentLanguage}`);
                        const data = await response.json();
                        
                        if (data.success && data.data) {
                            this.contentForm = {
                                title: data.data.title || '',
                                content: data.data.content || '',
                                contentAr: data.data.contentAr || '',
                                version: data.data.version || '1.0.0',
                                seoTitle: data.data.seoTitle || '',
                                seoDescription: data.data.seoDescription || '',
                                seoKeywords: data.data.seoKeywords || [],
                                seoKeywordsString: (data.data.seoKeywords || []).join(', '),
                                isActive: true
                            };
                        } else {
                            this.resetForm();
                        }
                    } catch (error) {
                        console.error('Error loading content:', error);
                        this.showMessage('Error loading content', 'error');
                    }
                },

                async loadAllContent() {
                    try {
                        const token = localStorage.getItem('adminToken');
                        const response = await fetch('/api/content/admin/all', {
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json'
                            }
                        });
                        const data = await response.json();
                        
                        if (data.success) {
                            this.allContent = data.data;
                        }
                    } catch (error) {
                        console.error('Error loading all content:', error);
                    }
                },

                async saveContent() {
                    this.loading = true;
                    try {
                        const token = localStorage.getItem('adminToken');
                        const formData = {
                            ...this.contentForm,
                            seoKeywords: this.contentForm.seoKeywordsString.split(',').map(k => k.trim()).filter(k => k)
                        };

                        const response = await fetch(`/api/content/${this.selectedType}`, {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(formData)
                        });

                        const data = await response.json();
                        
                        if (data.success) {
                            this.showMessage('Content saved successfully!', 'success');
                            await this.loadAllContent();
                        } else {
                            this.showMessage(data.message || 'Error saving content', 'error');
                        }
                    } catch (error) {
                        console.error('Error saving content:', error);
                        this.showMessage('Error saving content', 'error');
                    } finally {
                        this.loading = false;
                    }
                },

                async deleteContent(content) {
                    if (!confirm('Are you sure you want to delete this content?')) return;
                    
                    try {
                        const token = localStorage.getItem('adminToken');
                        const response = await fetch(`/api/content/${content.type}`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json'
                            }
                        });

                        const data = await response.json();
                        
                        if (data.success) {
                            this.showMessage('Content deleted successfully!', 'success');
                            await this.loadAllContent();
                        } else {
                            this.showMessage(data.message || 'Error deleting content', 'error');
                        }
                    } catch (error) {
                        console.error('Error deleting content:', error);
                        this.showMessage('Error deleting content', 'error');
                    }
                },

                editContent(content) {
                    this.selectedType = content.type;
                    this.loadContent();
                },

                previewContent() {
                    this.showPreview = true;
                },

                resetForm() {
                    this.contentForm = {
                        title: '',
                        content: '',
                        contentAr: '',
                        version: '1.0.0',
                        seoTitle: '',
                        seoDescription: '',
                        seoKeywords: [],
                        seoKeywordsString: '',
                        isActive: true
                    };
                },

                getContentTypeLabel(type = null) {
                    const contentType = this.contentTypes.find(ct => ct.value === (type || this.selectedType));
                    return contentType ? contentType.label : 'Unknown';
                },

                formatContent(content) {
                    return content ? content.replace(/\n/g, '<br>') : '';
                },

                formatDate(dateString) {
                    return new Date(dateString).toLocaleDateString();
                },

                showMessage(text, type = 'success') {
                    this.message = text;
                    this.messageType = type;
                    setTimeout(() => {
                        this.message = '';
                    }, 5000);
                },

                logout() {
                    localStorage.removeItem('adminToken');
                    window.location.href = '/admin/login';
                }
            }
        }
    </script>
</body>
</html>
